## 4.1. 규칙 형식

규칙을 사용하는 것은 Suricata에서 가장 중요한 역할이다. 대부분의 경우 사람들은 이미 정해진 규칙을 사용한다.

규칙을 설정하는 정의된 방법은 [Rule Management with Suricata-Update](https://suricata.readthedocs.io/en/suricata-4.1.4/rule-management/suricata-update.html)에 더 자세하게 나와있다.

Suricata 문서는 모든 규칙에 대해서 어떻게 읽고, 적용하고 그것들을 생성하는지 설명한다.

규칙과 표현들은 아래와 같이 구성되어 있다:
- action : 규칙과 일치했을 때, 무슨 일이 일어날지 정의
- header : 프로토콜, IP 주소, 포트와 규칙의 방향을 정의
- rule options : 규칙의 세부사항을 정의

</br>

하나의 규칙을 예를 들어보자:
> drop tcp $HOME_NET any -> $EXTERNAL_NET any (msg:”ET TROJAN Likely Bot Nick in IRC (USA +..)”; flow:established,to_server; flowbits:isset,is_proto_irc; content:”NICK “; pcre:”/NICK .*USA.*[0-9]{3,}/i”; reference:url,doc.emergingthreats.net/2008124; classtype:trojan-activity; sid:2008124; rev:2;)

위의 예시를 보면, `drop` = action, `tcp $HOME_NET any -> $EXTERNAL_NET any` = header, `(msg: ...)` = options 를 의미한다.

Suricata 인스턴스에 사용하고 무료로 다운로드할 수 있는 많은 규칙을 제공하는 오픈 데이터베이스인 Emerging Threats 데이터베이스에서 가져온 표현식이다.

### 4.1.1. Action 
``` text
drop tcp $HOME_NET any -> $EXTERNAL_NET any (msg:”ET TROJAN Likely Bot Nick in IRC (USA +..)”; flow:established,to_server; flowbits:isset,is_proto_irc; content:”NICK “; pcre:”/NICK .*USA.*[0-9]{3,}/i”; reference:url,doc.emergingthreats.net/2008124; classtype:trojan-activity; sid:2008124; rev:2;)
```

위의 규칙에서 `drop` 만 액션에 해당된다.

더 많은 정보는 [Action-order](https://suricata.readthedocs.io/en/suricata-4.1.4/configuration/suricata-yaml.html#suricata-yaml-action-order) 여기를 참고하면 된다.

</br>

### 4.1.2. Protocol

``` text
drop tcp $HOME_NET any -> $EXTERNAL_NET any (msg:”ET TROJAN Likely Bot Nick in IRC (USA +..)”; flow:established,to_server; flowbits:isset,is_proto_irc; content:”NICK “; pcre:”/NICK .*USA.*[0-9]{3,}/i”; reference:url,doc.emergingthreats.net/2008124; classtype:trojan-activity; sid:2008124; rev:2;)
```

위의 규칙에서 `tcp`가 프로토콜에 해당된다.

표현식에서 이 단어는 Suricata 프로토콜로 고려되는 것을 알려준다. 아래 4가지 기본 프로토콜 중에 선택할 수 있다.
- tcp (for tcp-traffic)
- udp
- icmp
- ip (ip stands for 'all' or 'any')

또한, 애플리케이션 계층에서 불리우는 몇몇 또는 7계층 프로토콜에서 선택해서 사용할 수 있다.

- http
- ftp
- tls (this includes ssl)
- smb
- dns
- dcerpc
- ssh
- smtp
- imap
- msn
- modbus (disabled by default)
- dnp3 (disabled by default)
- enip (disabled by default)
- nfs (depends on rust availability)
- ikev2 (depends on rust availability)
- ntp (depend on rust availability)
- dhcp (depends on rust availability)

이 프로토콜들의 사용은 suricata.yaml 구성 파일에 사용가능한 프로토콜인지에 달려있다.

만약 http 프로토콜 인스턴스와 함께 표현식을 사용한다면, Suricata는 http-traffic을 고려해서 그것에 맞는 표현식을 만들 것이다.
